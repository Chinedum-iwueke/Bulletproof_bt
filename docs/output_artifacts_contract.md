# Output Artifacts Contract

## What this contract covers
This contract defines run output artifacts, including always-required files and benchmark-conditional files.

Implementation: src/bt/logging/run_contract.py, src/bt/api.py, src/bt/logging/run_manifest.py

## V1 support
Required run artifacts (always expected by contract validator):

| Artifact | Presence |
| --- | --- |
| `config_used.yaml` | Always |
| `performance.json` | Always |
| `equity.csv` | Always |
| `trades.csv` | Always |
| `fills.jsonl` | Always |
| `decisions.jsonl` | Always |
| `performance_by_bucket.csv` | Always |

Conditional benchmark artifacts:

| Artifact | Presence |
| --- | --- |
| `benchmark_equity.csv` | When `benchmark.enabled=true` |
| `benchmark_metrics.json` | When `benchmark.enabled=true` |
| `comparison_summary.json` | When `benchmark.enabled=true` |

Implementation: src/bt/logging/run_contract.py, src/bt/api.py

## Inputs and guarantees
- Deterministic JSON serialization is used for JSON artifacts.
- If benchmark is enabled, benchmark artifacts are produced or run fails.
- `run_manifest.json` includes sorted artifact file listing and `schema_version: 1`.

Implementation: src/bt/logging/formatting.py, src/bt/api.py, src/bt/logging/run_manifest.py

## Rejections and failure modes
- Missing required artifacts trigger run-contract validation error.
- Benchmark enabled without benchmark outputs triggers failure.

Implementation: src/bt/logging/run_contract.py, src/bt/api.py

## Artifacts and where to look
- Required list validator: `validate_run_artifacts(...)`.
- Human summary: `summary.txt` (when generated by summary writer).
- Data scope metadata: `data_scope.json` (scope knobs only).

Implementation: src/bt/logging/run_contract.py, src/bt/logging/summary.py, src/bt/logging/trades.py

## Examples
Standard run outputs (no benchmark):

```yaml
# Expect required artifacts only
benchmark:
  enabled: false
```

Benchmark-enabled outputs:

```yaml
benchmark:
  enabled: true
  symbol: BTCUSDT
  price_field: close
```

## Versioning
- Contract version: v1.
- `run_manifest.json` exposes `schema_version: 1`.
- Required artifact set is managed as code constant and should evolve additively.

Observation points: tests/test_run_artifact_contract.py, tests/test_benchmark_artifacts_smoke.py, tests/test_stage_f_presentation_contract.py, tests/test_run_manifest_artifact.py

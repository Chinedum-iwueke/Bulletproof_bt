# Default backtest engine config: safe, streaming-first, and overlay-friendly.
# NOTE: Top-level fee/slippage keys are kept for legacy compatibility.
signal_delay_bars: 1
initial_cash: 100000.0
model: fixed_bps
fixed_bps: 5.0
maker_fee_bps: 1.0
taker_fee_bps: 2.0

# Data loading and streaming controls.
data:
  mode: streaming               # default for dataset directories; single-file auto-routing still applies
  symbols_subset: null          # optional explicit symbol allowlist
  max_symbols: null             # optional cap after symbol filtering
  date_range: null              # optional window; may also be {start: ..., end: ...}
  row_limit_per_symbol: null    # optional per-symbol row cap
  chunksize: 50000              # streaming chunk size; null also resolves to 50_000

# Execution and fill-model controls.
execution:
  intrabar_mode: worst_case     # conservative intrabar assumption
  # profile: tier2              # supported built-in profile (tier1|tier2|tier3|custom)
  spread_mode: none             # none | fixed_bps | bar_range_proxy
  # spread_bps: 1.0             # optional unless spread_mode=fixed_bps

  # Custom-only profile overrides (used only when execution.profile=custom):
  # maker_fee: 0.0
  # taker_fee: 0.0006
  # slippage_bps: 2.0
  # spread_bps: 1.0
  # delay_bars: 1

# Risk sizing and margin guardrails.
risk:
  mode: equity_pct
  r_per_trade: 0.005
  # risk_per_trade_pct: 0.005   # legacy alias accepted for compatibility
  max_positions: 5
  max_leverage: 1.5
  stop_resolution: strict       # strict | allow_legacy_proxy
  margin_buffer_tier: 1         # 1 | 2 | 3
  slippage_k_proxy: 0.0
  min_stop_distance_pct: 0.001
  max_notional_pct_equity: 1.0
  maintenance_free_margin_pct: 0.01
  min_stop_distance: null
  qty_rounding: none            # none | floor | round
  may_liquidate: false
  stop: {}                      # configure stop rules in overlays when needed
  # stop:
  #   mode: atr                 # atr | legacy_proxy
  #   atr_indicator: atr
  #   atr_multiple: 2.5

# Optional strategy-vs-benchmark tracking.
benchmark:
  enabled: false
  symbol: BTCUSDT
  price_field: close
  initial_equity: 10000.0
  fee_model: none

# Metrics/reconciliation settings.
# (No runtime metrics toggles are currently configurable in code.)
metrics: {}

# Logging/artifact settings.
# summary.txt and run_manifest.json are generated by Stage F helpers when invoked.
outputs:
  root_dir: outputs/runs
  jsonl: true

# Keep legacy HTF keys for compatibility with existing overlays.
htf_timeframes: ["5m", "15m", "1h"]
htf_strict: true
htf_resampler:
  timeframes: ["5m", "15m", "1h"]
  strict: true

# Strategy defaults to a deterministic baseline that runs on any dataset.
strategy:
  name: coinflip
  p_trade: 0.10
  cooldown_bars: 1

# Default backtest engine config: safe, streaming-first, and overlay-friendly.
# NOTE: Top-level fee/slippage keys are kept for legacy compatibility.
signal_delay_bars: 1
initial_cash: 100000.0
model: fixed_bps
fixed_bps: 5.0
maker_fee_bps: 1.0
taker_fee_bps: 2.0

# Data loading and streaming controls.
data:
  mode: streaming               # default for dataset directories; single-file auto-routing still applies
  symbols_subset: null          # optional explicit symbol allowlist
  max_symbols: null             # optional cap after symbol filtering
  date_range: null              # optional window; may also be {start: ..., end: ...}
  row_limit_per_symbol: null    # optional per-symbol row cap
  chunksize: 50000              # streaming chunk size

# Execution and fill-model controls.
execution:
  # profile: tier2              # tier1 | tier2 | tier3 | custom
  intrabar_mode: worst_case     # worst_case | best_case | midpoint
  spread_mode: none             # none | fixed_bps | bar_range_proxy
  # spread_bps: 1.0               # only used when spread_mode=fixed_bps

  # Custom-only profile overrides (used only when execution.profile=custom):
  # maker_fee: 0.0
  # taker_fee: 0.0006
  # slippage_bps: 2.0
  # delay_bars: 1

# Risk sizing and margin guardrails.
risk:
  mode: equity_pct
  r_per_trade: 0.005
  max_positions: 5
  max_leverage: 1.5
  stop_resolution: safe         # safe | strict
  allow_legacy_proxy: false     # safe default: no silent fallback/proxy sizing
  hybrid_policy: wider          # wider | tighter
  margin_buffer_tier: 1         # 1 | 2 | 3
  slippage_k_proxy: 0.0
  min_stop_distance_pct: 0.001
  min_stop_distance: null
  max_notional_pct_equity: 1.0
  maintenance_free_margin_pct: 0.01
  qty_rounding: none            # none | floor | round
  may_liquidate: false
  stop:
    mode: null                  # set to atr or legacy_proxy only in explicit overlays
    atr_indicator: atr
    atr_multiple: null

# Optional strategy-vs-benchmark tracking.
benchmark:
  enabled: false
  symbol: null
  price_field: close
  initial_equity: null
  fee_model: none

# Metrics/reconciliation settings.
metrics: {}

# Logging/artifact settings.
outputs:
  root_dir: outputs/runs
  jsonl: true

# Keep legacy HTF keys for compatibility with existing overlays.
htf_timeframes: ["5m", "15m", "1h"]
htf_strict: true
htf_resampler:
  timeframes: ["5m", "15m", "1h"]
  strict: true

# Strategy defaults to a deterministic baseline that runs on any dataset.
strategy:
  name: coinflip
  signal_conflict_policy: reject  # reject | first_wins | last_wins | net_out
  params: {}
  seed: 42
  p_trade: 0.10
  cooldown_bars: 1
  stop_atr_multiple: 2.0
  max_hold_bars: 60
